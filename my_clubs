import streamlit as st
from utils import get_snowflake_connection

def show():
    st.title("‚öΩ My Clubs")

    # Check if user is logged in
    if "user_email" not in st.session_state or not st.session_state["user_email"]:
        st.warning("üîí Please log in to view your clubs.")
        return

    user_email = st.session_state["user_email"]

    try:
        conn = get_snowflake_connection()
        cursor = conn.cursor()

        # Fetch clubs for the logged-in user
        cursor.execute("""
            SELECT * FROM PLAYER_CLUB_V WHERE email = %s
        """, (user_email,))
        rows = cursor.fetchall()
        columns = [col[0] for col in cursor.description]

        if rows:
            st.dataframe(data=rows, columns=columns, use_container_width=True)
        else:
            st.info("‚ÑπÔ∏è No clubs found for your account.")

    except Exception as e:
        st.error(f"‚ùå Error retrieving club data: {e}")
    finally:
        cursor.close()
        conn.close()
